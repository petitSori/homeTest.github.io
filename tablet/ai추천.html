<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Comaptible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>í…Œë¸”ë¦¿ì˜¤ë” ì²´í—˜í•˜ê¸°_aiì¶”ì²œ</title>

<link rel="stylesheet" href="./css/default.css" />
<link rel="stylesheet" href="./css/ai.css" />
</head>
<body>
	<!-- ë£¨íŠ¸ ì—˜ë¦¬ë¨¼íŠ¸ : ì‹œì‘ -->
	<div class="root-wrap">
		<div id="tutorial">
			<div id="mateTablet" class="tablet">
			</div>
		</div>
	</div>
	<!-- ë£¨íŠ¸ ì—˜ë¦¬ë¨¼íŠ¸ : ë -->
	
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
<script>
	let currentIndex = 0; // í˜„ì¬ ì„¹ì…˜ ì¸ë±ìŠ¤
	let autoSlideTimeout = null; // ë²„íŠ¼ ì—†ëŠ” ì„¹ì…˜ ìë™ ì´ë™ìš©
	let sections = []; // ì„¹ì…˜ ìš”ì†Œë¥¼ ì €ì¥í•  ë°°ì—´
	let autoSlideInterval; // ìë™ ìŠ¬ë¼ì´ë“œë¥¼ ìœ„í•œ ì¸í„°ë²Œ ë³€ìˆ˜
  
	// REST API ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
	fetch("./js/data/ai.json")
	.then(response => response.json())
	.then(data => {
		renderSections(data.sections);
		sections = document.querySelectorAll("#mateTablet .page-box");
		updateSectionClass(); // ì´ˆê¸° on í´ë˜ìŠ¤ ì„¤ì •
	})
	.catch(error => console.error("Error fetching data:", error));

	// Section ë™ì  ìƒì„± í•¨ìˆ˜
	function renderSections(dataSections) {
		const container = document.getElementById("mateTablet");
		container.innerHTML = ""; // ì´ˆê¸°í™”

		dataSections.forEach((section, index) => {
			const sectionElement = document.createElement("section");
			sectionElement.className = `page-box ${section.class || ""}`;
			sectionElement.dataset.step = section.dataStep;

			// ì¼ë°˜ ì„¹ì…˜ ë Œë”ë§
			if (section.content) {

				// ì„¹ì…˜ ì œëª©
				if (section.content.title) {
					const titleElement = document.createElement("div");
					titleElement.className = "title";
					titleElement.innerHTML = section.content.title.text;
				}

				// ì„¹ì…˜ ì´ë¯¸ì§€
				if (section.content.image) {
					const imageElement = document.createElement("div");
					imageElement.className = "img";

					const img = document.createElement("img");
					img.src = section.content.image.src;
					img.alt = section.content.image.alt || "";

					imageElement.appendChild(img);
				}

				// í’ì„  í…ìŠ¤íŠ¸
				if (section.content.bubble) {
					const bubbleWrap = document.createElement("div");
					bubbleWrap.className = "bubble-wrap";

					const bubbleText = document.createElement("p");
					bubbleText.textContent = section.content.bubble.text;
					bubbleWrap.appendChild(bubbleText);

				}

				if (section.content.description) {
					const descElement = document.createElement("p");
					descElement.className = "desc";
					descElement.textContent = section.content.description.text;
					sectionElement.appendChild(descElement);
				}
			}

			// ì´ë¯¸ì§€ ì¶”ê°€
			if (section.images) {
				section.images.forEach((img) => {
					const imgElement = document.createElement("img");
					imgElement.src = img.src;
					imgElement.className = img.class || "";
					sectionElement.appendChild(imgElement);
				});
			}

			// //ìŠ¤í¬ë¡¤ ë°•ìŠ¤
			if (section.scrollBox) {
				const scrollBox = document.createElement("div");
				const scrollInnerBox = document.createElement("div");
				const scrollImg = document.createElement("img");
				scrollBox.className = "scroll-box";
				scrollInnerBox.className = "scroll-inner-box";
				scrollImg.src = section.scrollBox.src;
				scrollImg.className = section.scrollBox.class || "";
				scrollInnerBox.appendChild(scrollImg);
				scrollBox.appendChild(scrollInnerBox);
				sectionElement.appendChild(scrollBox);
			}

			// ì¤‘ê°„ í…ìŠ¤íŠ¸ ì¶”ê°€
			if (section.texts) {
				const stepTitle = document.createElement("div");
				stepTitle.className = "step-title";
				stepTitle.innerHTML = section.texts;
				sectionElement.appendChild(stepTitle);
			}

			// ë²„íŠ¼ ì¶”ê°€
			if (section.button) {
				const button = document.createElement("button");
				button.type = "button";
				button.className = "btn-lottie";

				if (section.button.imageSrc) {
					const img = document.createElement("img");
					img.src = section.button.imageSrc;
					img.className = "btn-img";
					button.appendChild(img);
				}

				if (section.button.animationSrc) {
					const animContainer = document.createElement("div");
					animContainer.className = "animContainer";

					lottie.loadAnimation({
						container: animContainer,
						renderer: "svg",
						loop: true,
						autoplay: true,
						path: section.button.animationSrc,
					});

					button.appendChild(animContainer);
				}

				button.addEventListener("click", () => {
					// ğŸ”¹ cont + end í´ë˜ìŠ¤ê°€ ìˆëŠ” ì„¹ì…˜ì´ë©´ reload
					if (sectionElement.classList.contains("cont") && sectionElement.classList.contains("end")) {
						location.reload();
						return;
					}

					// ğŸ”¹ ì¼ë°˜ ì„¹ì…˜ â†’ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
					if (currentIndex < dataSections.length - 1) {
						currentIndex++;
						updateSectionClass();
					}
				});

				sectionElement.appendChild(button);
			}

			// í’ì„  ì´ë¯¸ì§€ ì¶”ê°€
			if (section.bubbleImage) {
				const bubbleImg = document.createElement("img");
				bubbleImg.src = section.bubbleImage.src;
				bubbleImg.className = section.bubbleImage.class || "";
				sectionElement.appendChild(bubbleImg);
			}


			container.appendChild(sectionElement);
		});
	}

	// ì„¹ì…˜ í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
	function updateSectionClass() {
		sections.forEach((section, index) => {
			if (index === currentIndex) {
				section.classList.add("on");
				const hasButton = section.querySelector(".btn-lottie");
				const images = section.querySelectorAll("img.step, img.balloon, .end-box, .step-title");
				let bounceIntervalId = null;

				if (!hasButton) {
					if (autoSlideTimeout) {
					clearTimeout(autoSlideTimeout);
					}

					autoSlideTimeout = setTimeout(() => {
					if (currentIndex < sections.length - 1) {
						currentIndex++;
						updateSectionClass();
					}
					}, 2000);

				} else {
					// ğŸ”¹ ë²„íŠ¼ ìˆëŠ” ì„¹ì…˜ â†’ ìë™ ì´ë™ ì œê±°
					if (autoSlideTimeout) {
					clearTimeout(autoSlideTimeout);
					autoSlideTimeout = null;
					}
				}

				// ì„¹ì…˜ì— ì†í•œ ì´ë¯¸ì§€ íˆ¬ëª…ë„ ì¡°ì •
				images.forEach((img, imgIndex) => {
					img.classList.add(`opacityAni${imgIndex + 1}`); // ê° ì´ë¯¸ì§€ì˜ ì‹œê°„ ì°¨ì´ ì„¤ì •
					if (img.classList.contains('balloon')) {
						img.style.transition = 'transform 0.8s linear';

						// ì´ë¯¸ bounceIntervalIdê°€ ì„¤ì •ëœ ê²½ìš° ì¤‘ë³µ ë°©ì§€
						if (!img.dataset.bounceId) {
							let direction = 1;
							img.dataset.bounceId = bounceIntervalId; // interval ID ì €ì¥
						}
					}

					if (img.classList.contains('end-box')) {
						img.classList.add("opacityAniEnd");
					}
				});

				const img = section.querySelector('.scroll-inner-box img');
				if (img) {
					img.style.transition = 'top 0.8s';
					img.style.top = '-96%';
				}
			} else {
				section.classList.remove("on");
				// ë‹¤ë¥¸ ì„¹ì…˜ì— ìˆëŠ” ì´ë¯¸ì§€ íˆ¬ëª…ë„ ì¡°ì •
				section.querySelectorAll("img.step, img.balloon, .step-title").forEach(img => {
					img.classList.remove(`opacityAni${index + 1}`);
					if (img.classList.contains('balloon')) {
						img.style.transform = '';
						img.style.transition = '';

						// bounceIntervalIdê°€ ìˆìœ¼ë©´ ì •ë¦¬
						if (img.dataset.bounceId) {
							clearInterval(img.dataset.bounceId);
							delete img.dataset.bounceId; // ì†ì„± ì œê±°
						}
					}
				});

				const img = section.querySelector('.scroll-inner-box img');
				if (img) {
				img.style.transition = 'top 0.8s';
				img.style.top = '0';
				}
			}
		});
	}
	function updateScale() {
	const vh = window.innerHeight;
	const scale = vh / 1200;

	document.documentElement.style.setProperty('--scale', scale);
}

	// ìµœì´ˆ ì‹¤í–‰
	updateScale();

	// ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘
	window.addEventListener('resize', updateScale);
</script>
</body>
</html>
